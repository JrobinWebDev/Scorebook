/*!
 * Scorebook Library v0.2.12.
 *
 * Copyright (C) 2013 Ryan Smith.
 * This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License (CC BY-NC-SA 3.0).
 * http://creativecommons.org/licenses/by-nc-sa/3.0/
 *
 * Date: 2013.1.6.
 */
var scorebook=function(e){"use strict";function n(e){return typeof e=="number"&&Math.floor(e)===e?e||0:0}function r(e){return e===!0||e===!1?e||!1:!1}function i(e){return Object.prototype.toString.call(e)==="[object Date]"?isNaN(e.getTime())?null:e:null}function s(e){return t.innings.push({id:t.innings.length,battingTeam:e}),!0}function o(e){return t.overs.push({inningId:t.innings.length-1,id:t.overs.length,bowlerId:e}),!0}function u(e,s,o,u,a,f,l,c,h,p,d,v,m,g){return s=n(s),c=n(c),h=n(h),p=n(p),d=n(d),v=n(v),m=n(m),l=r(l),o=r(o),u=r(u),a=r(a),f=r(f),g=i(g),e=e||(t.overs[t.overs.length-1].id===t.balls[t.balls.length-1].overId?t.balls[t.balls.length-1].batsmanId:null),t.balls.push({overId:t.overs.length-1,id:t.balls.length,batsmanId:e,runs:s,wideBall:o,noBall:u,byes:a,legByes:f,wicketId:l===!0?t.wickets.length-1:null,wagonX:c,wagonY:h,pitchX:p,pitchY:d,batPen:v,bwlPen:m,dateTime:g}),!0}function a(e,n,r){var i=(t.wickets.length>0&&t.balls.length>0?t.wickets[t.wickets.length-1].ballId!==t.balls.length:!0)==0?!1:/^(bowled|lbw|handled the ball|hit wicket|hit the ball twice)$/.test(n)?"bowler":/^(caught|stumped)$/.test(n)?"both":/^(runout)$/.test(n)?"fielder":/^(obstruction|timed out)$/.test(n)?"none":!1,s=i==="bowler"||i==="both"?t.overs[t.overs.length-1].bowlerId||null:null;return r=i==="fielder"||i==="both"?r||null:null,i!==!1&&t.wickets.push({ballId:t.balls.length,id:t.wickets.length,batsmanId:e,bowlerId:s,fielderId:r,howOut:n}),i!==!1}function f(){var e=t.innings.length!==t.overs[t.overs.length-1].inningId+1?t.innings:t.overs.length!==t.balls[t.balls.length-1].overId+1?t.overs:t.balls[t.balls.length-1].wicketId===null?t.balls:t.wickets;return e===t.wickets&&(t.balls[t.balls.length-1].wicketId=null),e.pop(),!0}function l(e,t,n){var r=!0,n=n||Object.keys(t),i;for(i=0;i<n.length&&r===!0;i+=1)e[n[i]]!==t[n[i]]&&(r=!1);return r}function c(e){var n=[];if(e?e.id:!1)(!e.battingTeam||e.battingTeam==t.innings[e.id].battingTeam)&&n.push(t.innings[e.id]);else{var r=t.innings.length,i=e?Object.keys(e):[],s;for(s=0;s<r;s+=1)l(t.innings[s],e,i)&&n.push(t.innings[s])}return n}function h(e,n){var r=[];if(n?n.id:!1)l(t.innings[t.overs[n.id].inningId],e,null)&&r.push(t.overs[n.id]);else{var i=t.overs.length,s=n?Object.keys(n):[],o;for(o=0;o<i;o+=1)l(t.overs[o],n,s)&&r.push(t.overs[o])}return r}function p(e,n,r){var i=[],s=h(e,n);if(r?r.id:!1)s[0].id===t.balls[r.id].overId&&i.push(t.balls[r.id]);else{var o=t.balls.length,u=s.length,a=r?Object.keys(r):[],f,c;for(f=0;f<o;f+=1)if(l(t.balls[f],r,a))for(c=0;c<u;c+=1)if(s[c].id===t.balls[f].overId){i.push(t.balls[f]);break}}return i}function d(e,n,r,i){var s=[],o=p(e,n,r);if(i?i.id:!1)o[0].id===t.wickets[i.id].ballId&&s.push(t.wickets[i.id]);else{var u=t.wickets.length,a=o.length,f=i?Object.keys(i):[],c,h;for(c=0;c<u;c+=1)if(l(t.wickets[c],i,f))for(h=0;h<a;h+=1)if(o[h].id===t.wickets[c].ballId){s.push(t.wickets[c]);break}}return s}var t=e;return t=t||{},t.innings=t.innings||[],t.overs=t.overs||[],t.balls=t.balls||[],t.wickets=t.wickets||[],{addInnings:s,addOver:o,addBall:u,addWicket:a,undo:f,getInnings:c,getOvers:h,getBalls:p,getWickets:d,data:t}};